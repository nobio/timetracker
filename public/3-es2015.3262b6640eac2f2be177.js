(window.webpackJsonp=window.webpackJsonp||[]).push([[3],{Y6Aa:function(t,e,i){"use strict";i.d(e,"a",(function(){return m}));var n=i("wd/R"),r=i.n(n),o=i("un/a"),a=i("JIr8");class s{get localEntryDate(){return this.entryDate?r()(this.entryDate).format("YYYY-MM-DDTHH:mm:ss.SSSZ"):void 0}set localEntryDate(t){this.entryDate=r()(t).format("YYYY-MM-DDTHH:mm:ss.SSSZ")}encodeEntry(t){return this.id=t._id,this.direction=t.direction,this.lastChanged=t.last_changed,this.entryDate=t.entry_date,this.longitude=t.longitude,this.latitude=t.latitude,"enter"==this.direction?(this.ion_direction_icon="enter",this.ion_color="primary",this.direction_translated="kommen"):"go"==this.direction&&(this.ion_direction_icon="exit",this.ion_color="secondary",this.direction_translated="gehen"),this}decodeEntry(){var t={};return t._id=this.id,t.last_changed=this.lastChanged,t.entry_date=this.entryDate,t.longitude=this.longitude,t.latitude=this.latitude,t.direction=this.direction,t}}class c{constructor(){this.workingTime="",this.pause="",this.totalWorkload=""}}var l=i("eHTu"),d=i("fXoL"),b=i("tk/3"),h=i("TEn/"),u=i("iXKo");let m=(()=>{class t extends l.a{constructor(t,e,i){super(t,e,i),this.httpClient=t,this.alertCtrl=e,this.logger=i,this.entriesByDate=[],this.selectedEntry=new s,this.entryStats=new c}loadEntriesByDate(t){this.logger.log("loading entries for "+t);const e=new Date(t).getTime();this.GET("/api/entries?dt="+e).pipe(Object(o.a)(2)).subscribe(t=>{this.entriesByDate=[],t.forEach(t=>{let e=new s;e.encodeEntry(t),this.entriesByDate.push(e)})})}loadEntry(t){this.logger.log("loading entry "+t),t&&this.GET("/api/entries/"+t).pipe(Object(o.a)(2),Object(a.a)(super.handleError)).subscribe(t=>{this.selectedEntry=new s,this.selectedEntry.encodeEntry(t)},t=>{throw super.handleError(t),new Error(t)})}createEntry(t,e){this.POST("/api/entries/",{direction:t.direction,datetime:t.entryDate,longitude:t.longitude,latitude:t.latitude}).subscribe(t=>{this.loadEntriesByDate(e)},t=>{throw super.handleError(t),this.loadEntriesByDate(e),new Error(t)})}loadWorkingTime(t){if(this.entryStats=new c,void 0===t)return this.entryStats.workingTime="na.",this.entryStats.pause="na.",void(this.entryStats.totalWorkload="na.");const e=new Date(t).getTime();this.GET("/api/entries?busy="+e).pipe(Object(o.a)(2),Object(a.a)(super.handleError)).subscribe(t=>{this.logger.log(t),this.entryStats.totalWorkload=this.millisecToReadbleTime(t.duration),this.entryStats.workingTime=this.millisecToReadbleTime(t.busytime),this.entryStats.pause=this.millisecToReadbleTime(t.pause)})}deleteSelectedEntry(){return this.DELETE("/api/entries/"+this.selectedEntry.id).pipe(Object(o.a)(2),Object(a.a)(super.handleError))}saveSelectedEntry(){return this.PUT("/api/entries/"+this.selectedEntry.id,this.selectedEntry.decodeEntry()).pipe(Object(o.a)(2),Object(a.a)(super.handleError))}loadDatesWithFailedEntries(){let t=new Array;return new Promise((e,i)=>{this.GET("/api/entries/error/dates").pipe(Object(o.a)(2),Object(a.a)(super.handleError)).subscribe(i=>{i.forEach(e=>{t.push({type:e["error-type"],date:e["error-date"],urlDate:r()(e["error-date"]).format("YYYY-MM-DD")})}),e(t)},t=>{super.handleError(t),this.logger.error(t,"Tage mit Fehlerhafen Eintr\xe4gen"),this.logger.error(t._body,"Tage mit Fehlerhafen Eintr\xe4gen"),this.selectedEntry=new s,i("Fehler beim Laden der Daten mit fehlerhaften Eintr\xe4gen: "+t)})})}millisecToReadbleTime(t){if(!t)return"";let e=new Date;return e.setTime(t),(e.getUTCHours()<10?"0"+e.getUTCHours():e.getUTCHours())+":"+(e.getUTCMinutes()<10?"0"+e.getUTCMinutes():e.getUTCMinutes())}}return t.\u0275fac=function(e){return new(e||t)(d.Qb(b.b),d.Qb(h.b),d.Qb(u.a))},t.\u0275prov=d.Fb({token:t,factory:t.\u0275fac,providedIn:"root"}),t})()},sCsk:function(t,e,i){"use strict";i.r(e),i.d(e,"EntriesPageModule",(function(){return M}));var n=i("TEn/"),r=i("ofXK"),o=i("3Pt+"),a=i("tyNb"),s=i("mrSG"),c=i("wd/R"),l=i.n(c),d=i("sPAB"),b=i("fXoL"),h=i("Y6Aa"),u=i("HmWd");const m=function(t){return["./entries",t]};function y(t,e){if(1&t&&(b.Mb(0,"ion-item",21),b.Kb(1,"ion-icon",22),b.mc(2," \xa0 "),b.Mb(3,"ion-label",23),b.mc(4),b.Xb(5,"date"),b.Lb(),b.Mb(6,"ion-label",24),b.mc(7),b.Lb(),b.Lb()),2&t){const t=e.$implicit;b.bc("routerLink",b.ec(9,m,t.id)),b.zb(1),b.cc("name",t.ion_direction_icon),b.cc("color",t.ion_color),b.zb(3),b.oc(" ",b.Yb(5,6,t.entryDate,"HH:mm")," Uhr "),b.zb(2),b.cc("color",t.ion_color),b.zb(1),b.oc(" ",t.direction_translated," ")}}const g=function(){return["./fails"]},p=[{path:"",component:(()=>{class t{constructor(t,e,i){this.timeEntryService=t,this.toastCtrl=e,this.route=i,this._date=(new Date).toISOString(),this.hasNoFailedDates=!1}ionViewWillEnter(){this.route.snapshot.params.date&&(this.date=l()(this.route.snapshot.params.date).toISOString()),this.date||(this.date=(new Date).toISOString()),this.timeEntryService.loadEntriesByDate(this.date),this.timeEntryService.loadWorkingTime(this.date),this.timeEntryService.loadDatesWithFailedEntries().then(t=>this.hasNoFailedDates=0===t.length)}enter(){return Object(s.a)(this,void 0,void 0,(function*(){this.createEntry("enter")}))}leave(){this.createEntry("go")}createEntry(t){return Object(s.a)(this,void 0,void 0,(function*(){const e={};e.direction=t,e.entryDate=this.date;try{const t=yield d.a.lookUpGeoLocation();e.latitude=t.latitude,e.longitude=t.longitude,yield this.timeEntryService.createEntry(e,this.date)}catch(i){this.presentMessage(i,2e4)}}))}set date(t){this._date=t,this.timeEntryService.loadEntriesByDate(this.date),this.timeEntryService.loadWorkingTime(this.date)}get date(){return this._date}setYesterday(){let t=new Date(this.date);t.setDate(t.getDate()-1),this.date=t.toISOString()}setToday(){this.date=(new Date).toISOString()}setTomorrow(){let t=new Date(this.date);t.setDate(t.getDate()+1),this.date=t.toISOString()}presentMessage(t,e){return Object(s.a)(this,void 0,void 0,(function*(){(yield this.toastCtrl.create({message:t,duration:e})).present()}))}}return t.\u0275fac=function(e){return new(e||t)(b.Jb(h.a),b.Jb(n.T),b.Jb(a.a))},t.\u0275cmp=b.Db({type:t,selectors:[["app-entries"]],decls:40,vars:18,consts:[[3,"translucent"],["displaySize","small"],[3,"fullscreen"],["collapse","condense"],["size","large"],["padding",""],["size","12","size-sm","8","offset-sm","2"],["icon-left","","color","primary",1,"button","button-full",3,"click"],["name","log-in"],["icon-left","","color","secondary",1,"button","button-full",3,"click"],["name","log-out"],[3,"click"],["name","arrow-back"],["name","calendar"],["name","arrow-forward"],["color","warning","outline","",3,"disabled","routerLink"],["name","hammer"],["color","light"],["size","large","displayFormat","HH:mm","pickerFormat","DDD MMM YYYY H mm",3,"ngModel","ngModelChange"],["color","warning",1,"info-line"],[3,"routerLink",4,"ngFor","ngForOf"],[3,"routerLink"],["size","large",3,"name","color"],["lot","end"],["slot","end",3,"color"]],template:function(t,e){1&t&&(b.Mb(0,"ion-header",0),b.Mb(1,"ion-toolbar"),b.Mb(2,"ion-title"),b.mc(3," Timetracker "),b.Lb(),b.Lb(),b.Kb(4,"online-status-component",1),b.Lb(),b.Mb(5,"ion-content",2),b.Mb(6,"ion-header",3),b.Mb(7,"ion-toolbar"),b.Mb(8,"ion-title",4),b.mc(9,"Eintr\xe4ge"),b.Lb(),b.Lb(),b.Lb(),b.Mb(10,"ion-grid",5),b.Mb(11,"ion-row"),b.Mb(12,"ion-col",6),b.Mb(13,"ion-button",7),b.Ub("click",(function(){return e.enter()})),b.Kb(14,"ion-icon",8),b.mc(15),b.Xb(16,"date"),b.Lb(),b.Mb(17,"ion-button",9),b.Ub("click",(function(){return e.leave()})),b.Kb(18,"ion-icon",10),b.mc(19),b.Xb(20,"date"),b.Lb(),b.Lb(),b.Lb(),b.Mb(21,"ion-row"),b.Mb(22,"ion-col",6),b.Mb(23,"ion-button",11),b.Ub("click",(function(){return e.setYesterday()})),b.Kb(24,"ion-icon",12),b.Lb(),b.Mb(25,"ion-button",11),b.Ub("click",(function(){return e.setToday()})),b.Kb(26,"ion-icon",13),b.Lb(),b.Mb(27,"ion-button",11),b.Ub("click",(function(){return e.setTomorrow()})),b.Kb(28,"ion-icon",14),b.Lb(),b.Mb(29,"ion-button",15),b.Kb(30,"ion-icon",16),b.Lb(),b.Mb(31,"ion-button",17),b.Mb(32,"ion-datetime",18),b.Ub("ngModelChange",(function(t){return e.date=t})),b.Lb(),b.Lb(),b.Lb(),b.Lb(),b.Mb(33,"ion-row"),b.Mb(34,"ion-col",6),b.Mb(35,"ion-item"),b.Mb(36,"ion-label",19),b.mc(37),b.Lb(),b.Lb(),b.Mb(38,"ion-list"),b.kc(39,y,8,11,"ion-item",20),b.Lb(),b.Lb(),b.Lb(),b.Lb(),b.Lb()),2&t&&(b.bc("translucent",!0),b.zb(5),b.bc("fullscreen",!0),b.zb(10),b.oc("\xa0Kommen (",b.Yb(16,11,e.date,"EEE, dd.MM.yyyy - HH:mm"),") "),b.zb(4),b.oc("\xa0Gehen (",b.Yb(20,14,e.date,"EEE, dd.MM.yyyy - HH:mm"),") "),b.zb(10),b.cc("disabled",e.hasNoFailedDates),b.bc("routerLink",b.dc(17,g)),b.zb(3),b.bc("ngModel",e.date),b.zb(5),b.qc(" Gesamt ",e.timeEntryService.entryStats.totalWorkload," | Arbeit ",e.timeEntryService.entryStats.workingTime," | Pause ",e.timeEntryService.entryStats.pause," "),b.zb(2),b.bc("ngForOf",e.timeEntryService.entriesByDate))},directives:[n.r,n.K,n.I,u.a,n.o,n.q,n.z,n.n,n.g,n.s,n.Q,a.h,n.p,n.R,o.e,o.h,n.u,n.v,n.w,r.j],pipes:[r.d],styles:[".info-line[_ngcontent-%COMP%]{font-size:13px}"]}),t})()},{path:"entries/:id",loadChildren:()=>i.e(23).then(i.bind(null,"C2n5")).then(t=>t.EntryPageModule)},{path:"entries/:id/map",loadChildren:()=>Promise.all([i.e(2),i.e(25)]).then(i.bind(null,"gmQf")).then(t=>t.MapPageModule)},{path:"fails",loadChildren:()=>i.e(24).then(i.bind(null,"9dms")).then(t=>t.FailsPageModule)}];let E=(()=>{class t{}return t.\u0275mod=b.Hb({type:t}),t.\u0275inj=b.Gb({factory:function(e){return new(e||t)},imports:[[a.i.forChild(p)],a.i]}),t})();var f=i("1tww");let M=(()=>{class t{}return t.\u0275mod=b.Hb({type:t}),t.\u0275inj=b.Gb({factory:function(e){return new(e||t)},imports:[[n.L,r.b,o.b,f.a,E]]}),t})()}}]);